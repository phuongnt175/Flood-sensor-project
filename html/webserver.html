<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Configuration</title>
    <style>
        hr {
            border: 1px solid white; /* Set the border color to white */
            margin: 20px 0; /* Add some margin above and below the horizontal rule */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ecf0f1;
            /* Light gray background */
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            display: flex;
            height: auto;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            min-width: auto;
            margin-top: 100px;
        }

        .tab {
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            margin-bottom: 10px;
            color: black;
            text-align: center;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
            /* Added transition effect */
        }

        .tab.active {
            background-color: #3498db;
            /* Darker blue for the active tab */
            border-color: #1c6c99;
            /* Darker blue border for the active tab */
        }

        .tab-content {
            max-width: 600px;
            width: 100%;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            background-color: #3498db;
            /* Set background color for tabs */
            color: white;
            /* Set text color for tabs */
        }

        .hidden {
            display: none;
        }

        label {
            display: block;
            margin-top: 10px;
            margin-bottom: 5px; /* Adjust the bottom margin as needed */
            color: white; /* Set label color to match tab text color */
        }

        input,
        select {
            width: 30%;
            padding: 8px;
            margin-top: 5px;
            box-sizing: border-box;
            margin-left: auto;
        }

        /* Flex container for label and input elements */
        .flex-container {
            display: flex;
            justify-content: 0px;
            align-items: center;
            padding: 0;
        }
        
        .flex-container2 {
            max-width: 600px;
            width: 100%;
            padding: 0; /* Set padding to zero */
        }

        /* Style for MAC Address */
        .device-info {
        display: inline-block;
        margin-left: auto; /* This will align the text to the right */
        }


        button {
            background-color: white;
            color: #3498db;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            margin-left: auto;
            display: block;
            font-size: 16px;
            font-weight: bold;
        }

        resetButton {
            background-color: white;
            color: #3498db;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            margin-left: center;
            display: block;
            font-size: 16px;
            font-weight: bold;
        }

        button:hover {
            background-color: #45a049;
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <div class="tab" onclick="showTab('tab1')" id="tab1"> Sys Status </div>
        <div class="tab" onclick="showTab('tab2')" id="tab2"> WiFi Setting </div>
        <div class="tab" onclick="showTab('tab3')" id="tab3"> Reboot </div>
    </div>

    <div id="tab1" class="tab-content">
        <h2>System Status</h2><hr>
        <div class="flex-container2">
            <p><strong>Module MAC:</strong> <span class="device-info" id="t1-mac-address">..........</span></p>
        </div>
        <div class="flex-container2">
            <p><strong>Module Version:</strong> <span class="device-info" id="t1-module-version">..........</span></p>
        </div>
        <h2>WiFi Status</h2><hr>
        <div class="flex-container2">
            <p><strong>WiFi Mode:</strong> <span class="device-info" id="t1-wifi-mode">..........</span></p>
        </div>
        <h2>AP Status</h2><hr>
        <div class="flex-container2">
            <p><strong>AP SSID:</strong> <span class="device-info" id="t1-ap-ssid">..........</span></p>
        </div>
        <div class="flex-container2">
            <p><strong>AP IP:</strong> <span class="device-info" id="t1-ap-ip">..........</span></p>
        </div>
        <div class="flex-container2">
            <p><strong>AP Channel:</strong> <span class="device-info" id="t1-ap-chan">..........</span></p>
        </div>
        <h2>Station Status</h2><hr>
        <div class="flex-container2">
            <p><strong>Station DHCP:</strong> <span class="device-info" id="t1-sta-status">..........</span></p>
        </div>
        <div class="flex-container2">
            <p><strong>Station IP:</strong> <span class="device-info" id="t1-sta-ip">..........</span></p>
        </div>
        <div class="flex-container2">
            <p><strong>Station Subnet Mask:</strong> <span class="device-info" id="t1-sta-submask">..........</span></p>
        </div>
        <div class="flex-container2">
            <p><strong>Station Gateway:</strong> <span class="device-info" id="t1-sta-gateway">..........</span></p>
        </div>
        <div class="flex-container2">
            <p><strong>Station DNS:</strong> <span class="device-info" id="t1-sta-dns">..........</span></p>
        </div>
    </div> 

    <div id="tab2" class="tab-content hidden">
        <h2>WIFI Set</h2><hr>
        <form id="config-form">
            <!-- Flex container for label and select elements with margin-bottom -->
            <div class="flex-container">
                <label for="wifiMode">Wi-Fi Role:</label>
                <select id="t2-wifiMode" name="wifiMode">
                    <option value = "select"> ---Select--- </option>
                    <option value="ap">Access Point (AP)</option>
                    <option value="station">Station</option>
                </select>
            </div>
        <section id = "apsection" style="display: none;">
            <h2>AP Set</h2><hr>
            <!-- Flex container for label and input elements with margin-bottom -->
            <div class="flex-container">
                <label for="ssid">SSID:</label>
                <input type="text" id="t2-ap-ssid" name="ap-ssid" placeholder=" ">
            </div>
            <div class="flex-container">
                <label for="secure">Security type:</label>
                <select id="t2-ap-secure" name="ap-secure">
                    <option value = "select"> ---Select--- </option>
                    <option value="open">OPEN</option>
                    <option value="wpa2">WPA2</option>
                </select>
            </div>
            <section id = "apPassSection" style="display: none;">
            <div class="flex-container">
                <label for="password">Password:</label>
                <input type="password" id="t2-ap-pass" name="ap-pass" placeholder=" ">
            </div>
            </section>
            <div class="flex-container">
                <label for="channel">Channel:</label>
                <input type="channel" id="t2-ap-chan" name="ap-chan" placeholder=" ">
            </div>
        </section>
        <section id = "stationsection" style="display: none;">
            <h2>Station Set</h2><hr>
            <div class="flex-container">
                <label for="ssid">SSID:</label>
                <input type="text" id="t2-sta-ssid" name="sta-ssid" placeholder=" ">
            </div>
            
            <div class="flex-container">
                <label for="secure">Security type:</label>
                <select id="t2-sta-secure" name="ap-secure">
                    <option value ="select"> ---Select--- </option>
                    <option value="open">OPEN</option>
                    <option value="wpa2">WPA2</option>
                </select>
            </div>
            
            <section id = "staPassSection" style="display: none;">
            <div class="flex-container">
                <label for="password">Password:</label>
                <input type="password" id="t2-sta-pass" name="sta-pass" placeholder=" ">
            </div>
            </section>
            <div class="flex-container">
                <label for="dhcp">Use DHCP:</label>
                <select id="t2-dhcp" name="dhcp">
                    <option value ="select"> ---Select--- </option>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                </select>
            </div>
            <section id = "DhcpSection" style="display: none;">
            <div class="flex-container">
                <label for="ipAddress">IP Address:</label>
                <input type="text" id="t2-ipAddress" name="ipAddress" placeholder=" ">
            </div>
            <div class="flex-container">
                <label for="subnetMask">Subnet Mask:</label>
                <input type="text" id="t2-subnetMask" name="subnetMask" placeholder=" ">
            </div>
            <div class="flex-container">
                <label for="Gateway">Gateway:</label>
                <input type="text" id="t2-Gateway" name="Gateway" placeholder=" ">
            </div>
            <div class="flex-container">
                <label for="DNS">DNS:</label>
                <input type="text" id="t2-DNS" name="DNS" placeholder=" "> 
            </div>
            </section>
        </section>
            <button type="submit">SAVE</button>
        </form>
    </div>
    <div id="tab3" class="tab-content hidden">
        <h2>Important Notice</h2>
        <!-- Content for Tab 3 -->
        <p>After reloading factory settings, all user's configurations will become default.</p>
        <p>Reboot will restart the device, and any configuration will take effect afterward.</p>

        <form action="/restart" method="post">
            <button id="restartButton" onclick="restartESP()">Restart</button>
        </form> 
    </div>

    <script>
    
        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab-content');
            const tabButtons = document.querySelectorAll('.tab');

            tabs.forEach(tab => {
                if (tab.id === tabId) {
                    tab.classList.remove('hidden');
                } else {
                    tab.classList.add('hidden');
                }
            });

            tabButtons.forEach(button => {
                if (button.id === tabId) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
        }

        function restartESP() {
        // Make an asynchronous request to the ESP32
        var xhttp3 = new XMLHttpRequest();
        xhttp3.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                // Upon successful response, initiate a page reload
                location.reload(true);
            }
        };

        xhttp3.open("POST", "/restart", true);
        xhttp3.send();
    }
        

        var xhttp1 = new XMLHttpRequest();
        var xhttp2 = new XMLHttpRequest();

        document.addEventListener('DOMContentLoaded', function () {
            
            const wifiRoleSelect = document.getElementById("t2-wifiMode");
            const apSection = document.getElementById("apsection");
            const stationSection = document.getElementById("stationsection");
            const secureAP = document.getElementById("t2-ap-secure");
            const secureSTA = document.getElementById("t2-sta-secure");
            const apPassSection = document.getElementById("apPassSection");
            const staPassSection = document.getElementById("staPassSection");
            const dhcpSelect = document.getElementById("t2-dhcp");
            const dhcpSection = document.getElementById("DhcpSection");
            
            
            secureAP.addEventListener('change', (event) => {
                if (secureAP.value === "wpa2") {
                    // If AP is selected, show AP section and hide Station section
                    apPassSection.style.display = "block";
                } else if (secureAP.value === "open") {
                    // If Station is selected, show Station section and hide AP section
                    apPassSection.style.display = "none";
                }
            });
            
            secureSTA.addEventListener('change', (event) => {
                if (secureSTA.value === "wpa2") {
                    // If AP is selected, show AP section and hide Station section
                    staPassSection.style.display = "block";
                } else if (secureSTA.value === "open") {
                    // If Station is selected, show Station section and hide AP section
                    staPassSection.style.display = "none";
                }
            });
            
            dhcpSelect.addEventListener('change', (event) => {
                if (dhcpSelect.value === "true") {
                    // If AP is selected, show AP section and hide Station section
                    DhcpSection.style.display = "none";
                } else if (dhcpSelect.value === "false") {
                    // If Station is selected, show Station section and hide AP section
                    DhcpSection.style.display = "block";
                }
            });

            wifiRoleSelect.addEventListener('change', (event) => {
                if (wifiRoleSelect.value === "ap") {
                    // If AP is selected, show AP section and hide Station section
                    apSection.style.display = "block";
                    stationSection.style.display = "none";
                } else if (wifiRoleSelect.value === "station") {
                    // If Station is selected, show Station section and hide AP section
                    apSection.style.display = "none";
                    stationSection.style.display = "block";
                }
                else{
                    apSection.style.display = "none";
                    stationSection.style.display = "none";
                }
            });
            
    const form = document.getElementById('config-form');

    form.addEventListener('submit', function (event) {
        event.preventDefault();

        var wifiMode = document.getElementById('t2-wifiMode').value;
        var dhcp = document.getElementById('t2-dhcp').value;

        var formAP = {
            wifiMode: document.getElementById('t2-wifiMode').value,
            dhcp: document.getElementById('t2-dhcp').value,
            ssid: document.getElementById('t2-ap-ssid').value,
            password: document.getElementById('t2-ap-pass').value,
            channel: document.getElementById('t2-ap-chan').value
        }
        
        var formSTA = {
            wifiMode: document.getElementById('t2-wifiMode').value,
            dhcp: document.getElementById('t2-dhcp').value,
            ssid: document.getElementById('t2-sta-ssid').value,
            password: document.getElementById('t2-sta-pass').value
        }

        var formDHCP = {
            wifiMode: document.getElementById('t2-wifiMode').value,
            dhcp: document.getElementById('t2-dhcp').value,
            ssid: document.getElementById('t2-sta-ssid').value,
            password: document.getElementById('t2-sta-pass').value,
            ipAddress: document.getElementById('t2-ipAddress').value,
            subnetMask: document.getElementById('t2-subnetMask').value,
            gateway: document.getElementById('t2-Gateway').value,
            dns: document.getElementById('t2-DNS').value

        }

        if(wifiMode == 'ap')
        {
            var data = JSON.stringify(formAP);
        }
        else if(wifiMode == 'station')
        {
            if(dhcp == 'true')
            {
                var data = JSON.stringify(formSTA);
            }
            else if(dhcp == 'false')
            {
                var data = JSON.stringify(formDHCP);
            }
        }

        xhttp1.open("POST", "/post", true);
        xhttp1.setRequestHeader('Content-Type', 'application/json');
        xhttp1.send(data);
        showAlert();
    });
});


        xhttp2.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                const responseObj = JSON.parse(this.responseText);
            
                // Update MAC Address
                const macAddressElement = document.getElementById("t1-mac-address");
                macAddressElement.innerText = responseObj.macAddress;

                // Update Module Version
                const moduleVersionElement = document.getElementById("t1-module-version");
                moduleVersionElement.innerText = responseObj.moduleVersion;

                // Update WiFi Mode
                const wifiModeElement = document.getElementById("t1-wifi-mode");
                wifiModeElement.innerText = responseObj.wifiMode;

                // Update AP SSID
                const apSsidElement = document.getElementById("t1-ap-ssid");
                apSsidElement.innerText = responseObj.apSsid;

                // Update AP IP
                const apIpElement = document.getElementById("t1-ap-ip");
                apIpElement.innerText = responseObj.apIp;

                //update AP Channel
                const apChanElement = document.getElementById("t1-ap-chan");
                apChanElement.innerText = responseObj.apChan;

                // Update station DHCP status
                const staDHCPElement = document.getElementById("t1-sta-status");
                staDHCPElement.innerText = responseObj.staDHCP;

                // Update station IP
                const staIpElement = document.getElementById("t1-sta-ip");
                staIpElement.innerText = responseObj.staIp;

                // Update station SubnetMask
                const staSubMaskElement = document.getElementById("t1-sta-submask");
                staSubMaskElement.innerText = responseObj.staSubMask;

                // Update AP IP
                const staGatewayElement = document.getElementById("t1-sta-gateway");
                staGatewayElement.innerText = responseObj.staGateway;

                // Update AP IP
                const staDNSElement = document.getElementById("t1-sta-dns");
                staDNSElement.innerText = responseObj.staDNS;
            }
        };

        setInterval(function () {
            xhttp2.open("GET", "/sysinfo", true);
            xhttp2.send();
        }, 1000); // Adjust the interval as needed

        // Function to show the alert and remove the button
        function showAlert() {
            alert("parameter saved successfully and will take effect after restart!");
            var button = document.getElementById('showAlertButton');
            button.parentNode.removeChild(button);
        }
    </script>
</body>

</html>